<!DOCTYPE html>
<html lang="en" data-theme="purple">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emily A.I</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #030305; --accent: #c084fc; 
            --glass: rgba(255, 255, 255, 0.03);
            --card-bg: rgba(255, 255, 255, 0.07);
            --border: rgba(255, 255, 255, 0.12);
            --text: #ffffff; --blur: blur(30px);
            --theme-light: #1a0b2e;
        }
        [data-theme="red"] { --accent: #ff4e4e; --theme-light: #2e0b0b; }
        [data-theme="green"] { --accent: #4eff8a; --theme-light: #0b2e14; }
        [data-theme="blue"] { --accent: #4ec3ff; --theme-light: #0b1e2e; }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: var(--text); min-height: 100vh; width: 100vw; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow-x: hidden; transition: background 0.6s ease; }
        body.glow-off { background: var(--theme-light) !important; }

        #dynamic-glow { position: fixed; width: 60vw; height: 60vw; background: radial-gradient(circle, var(--accent), transparent 70%); filter: blur(80px); opacity: 0.4; pointer-events: none; z-index: -1; top: -10vw; right: -10vw; transition: opacity 0.5s ease; }

        /* --- SCANNER REVEAL EFFECT --- */
        #scanner { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 8px; 
            background: #4eff8a; box-shadow: 0 0 25px #4eff8a; z-index: 10000; 
        }
        
        .reveal-active {
            clip-path: inset(0 0 100% 0); /* Start hidden from bottom */
            animation: revealUI 9s linear forwards;
        }

        @keyframes scanMove {
            0% { top: 0; }
            100% { top: 100%; }
        }

        @keyframes revealUI {
            0% { clip-path: inset(0 0 100% 0); }
            100% { clip-path: inset(0 0 0% 0); }
        }

        /* --- LOADING SCREEN --- */
        #loading-screen { display: none; width: 90%; max-width: 450px; text-align: center; padding: 40px; z-index: 1000; }
        .progress-container { width: 100%; height: 10px; background: rgba(255,255,255,0.1); border-radius: 20px; margin-top: 25px; overflow: hidden; }
        #progress-bar { width: 0%; height: 100%; background: var(--accent); transition: width 0.1s linear; box-shadow: 0 0 15px var(--accent); }

        .panel { background: var(--glass); backdrop-filter: var(--blur); border: 1px solid var(--border); border-radius: 28px; display: flex; flex-direction: column; }
        #login-screen { width: 90%; max-width: 400px; padding: 50px 40px; text-align: center; }
        .login-input { width: 100%; padding: 18px; background: rgba(0,0,0,0.4); border: 1px solid var(--border); border-radius: 16px; color: white; margin-bottom: 12px; outline: none; }
        
        #app-wrapper { display: none; width: 100%; max-width: 1400px; padding: 20px; }
        .main-container { display: flex; gap: 20px; width: 100%; height: 85vh; }
        .sidebar { width: 280px; flex-shrink: 0; padding: 30px; }
        .chat-panel { flex: 1; min-width: 0; position: relative; display: flex; flex-direction: column; }
        .admin-panel { width: 320px; flex-shrink: 0; padding: 30px; }

        .chat-header { padding: 20px 25px 0 25px; font-weight: 700; font-size: 14px; opacity: 0.8; letter-spacing: 1px; color: var(--accent); }
        #messages { flex-grow: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 15px; scrollbar-width: none; }
        .bubble { padding: 16px 22px; border-radius: 24px; max-width: 85%; font-size: 14px; line-height: 1.6; }
        .b-user { align-self: flex-end; background: var(--accent); color: #000; font-weight: 700; border-bottom-right-radius: 4px; }
        .b-ai { align-self: flex-start; background: var(--card-bg); border: 1px solid var(--border); border-bottom-left-radius: 4px; }

        .input-box { padding: 15px 20px; display: flex; align-items: center; gap: 15px; border-top: 1px solid var(--border); background: rgba(0,0,0,0.2); margin-top: auto; }
        .input-pill { flex: 1; background: rgba(255,255,255,0.05); border-radius: 50px; padding: 0 20px; }
        #msgIn { background: transparent; border: none; padding: 15px 0; color: white; width: 100%; outline: none; }

        .send-btn { background: var(--accent); color: #000; border: none; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .action-btn { width: 100%; padding: 15px; border-radius: 18px; border: 1px solid var(--border); background: rgba(255,255,255,0.05); color: white; font-weight: 700; cursor: pointer; margin-bottom: 12px; }
        .theme-dot { height: 45px; border-radius: 14px; cursor: pointer; border: 1px solid var(--border); }
        
        .user-count { background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 6px; font-size: 10px; margin-left: 10px; }
        .search-input { width: 100%; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 12px; padding: 12px 15px; color: white; margin-bottom: 15px; outline: none; }
        .user-card { background: rgba(255,255,255,0.04); padding: 20px; border-radius: 24px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border); }
        .action-stack { display: flex; flex-direction: column; align-items: flex-end; gap: 2px; }
        .u-btn { font-size: 10px; font-weight: 800; cursor: pointer; text-transform: uppercase; }
        
        .core-badge { color: #FFD700; font-size: 11px; font-weight: 900; letter-spacing: 1px; animation: core-pulse 2s infinite ease-in-out; }
        @keyframes core-pulse { 0%, 100% { opacity: 0.6; text-shadow: 0 0 2px #FFD700; } 50% { opacity: 1; text-shadow: 0 0 10px #FFD700; } }

        @media (max-width: 1100px) { 
            #app-wrapper { height: 100vh; padding: 10px; }
            .main-container { flex-direction: column; height: auto; gap: 10px; } 
            .sidebar, .admin-panel { width: 100%; order: 2; padding: 20px; } 
            .chat-panel { width: 100%; height: 60vh; order: 1; }
        }
    </style>
</head>
<body>

    <div id="scanner"></div>
    <div id="dynamic-glow"></div>

    <div id="login-screen" class="panel">
        <h1 style="margin-bottom: 30px;">Emily A.I</h1>
        <input type="text" id="uIn" class="login-input" placeholder="Username">
        <div style="position:relative">
            <input type="password" id="pIn" class="login-input" placeholder="Password">
            <span style="position:absolute; right:20px; top:18px; cursor:pointer" onclick="tglP()">üëÅÔ∏è</span>
        </div>
        <button onclick="login()" class="action-btn" style="background:var(--accent); color:#000; border:none">INITIALIZE</button>
    </div>

    <div id="loading-screen" class="panel">
        <h2 style="color:var(--accent)">Logging In!</h2>
        <h3 id="welcome-msg" style="margin: 10px 0;">Hey! User</h3>
        <p style="opacity: 0.7;">Welcome To Evan's Creation!</p>
        <div class="progress-container">
            <div id="progress-bar"></div>
        </div>
        <p style="font-size: 12px; margin-top: 15px; opacity: 0.5;">DECRYPTING ACSSES FOR USE...</p>
    </div>

    <div id="app-wrapper">
        <div class="main-container">
            <div class="panel sidebar">
                <p style="font-size:11px; opacity:0.6; margin-bottom:15px">SYSTEM CORE</p>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom: 25px;">
                    <div class="theme-dot" style="background:#c084fc" onclick="setT('purple')"></div>
                    <div class="theme-dot" style="background:#ff4e4e" onclick="setT('red')"></div>
                    <div class="theme-dot" style="background:#4eff8a" onclick="setT('green')"></div>
                    <div class="theme-dot" style="background:#4ec3ff" onclick="setT('blue')"></div>
                </div>
                <button class="action-btn" id="tBtn" onclick="tglT()">UK VOICE: OFF</button>
                <button class="action-btn" onclick="tglGlow()">[LIGHT TOP]</button>
                <button class="action-btn" onclick="document.getElementById('messages').innerHTML=''">NEW SESSION</button>
                <div style="flex:1"></div>
                <button class="action-btn" style="color:#ff4e4e; border-color:rgba(255,78,78,0.3)" onclick="location.reload()">TERMINATE</button>
            </div>

            <div class="panel chat-panel">
                <div class="chat-header">Evan's Creation V.1.67.6</div>
                <div id="messages"></div>
                <div class="input-box">
                    <button id="mBtn" onclick="startR()" style="background:none; border:none; color:var(--accent); font-size:22px; cursor:pointer">üé§</button>
                    <div class="input-pill"><input type="text" id="msgIn" placeholder="Send a message..." onkeypress="if(event.key=='Enter') send()"></div>
                    <button onclick="send()" class="send-btn">‚ûî</button>
                </div>
            </div>

            <div id="adminPanel" class="panel admin-panel" style="display:none">
                <p style="font-size:11px; opacity:0.6; margin-bottom:15px">ROOT ACCESS <span id="uCount" class="user-count">0</span></p>
                <input type="text" id="rU" class="login-input" placeholder="New User">
                <input type="text" id="rP" class="login-input" placeholder="New Pass">
                <button class="action-btn" style="background:var(--accent); color:#000" onclick="reg()">CREATE</button>
                <input type="text" id="uSearch" class="search-input" placeholder="Search users..." oninput="filterU()">
                <div id="uList" style="overflow-y:auto; flex:1"></div>
            </div>
        </div>
    </div>

    <script>
        const SB_URL = 'https://wssqoindudmqpzaoadbh.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indzc3FvaW5kdWRtcXB6YW9hZGJoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc3MDE0ODgwMCwiZXhwIjoyMDg1NzI0ODAwfQ.-CTdo1CNv_swkxI2KOo5LxmKhr9rzoncBTaXaQXQgz8';
        const G_KEY = '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';
        const _s = supabase.createClient(SB_URL, SB_KEY);
        let talk = false, allUsers = [];

        function tglP() { const p = document.getElementById('pIn'); p.type = p.type === 'password' ? 'text' : 'password'; }
        function setT(t) { document.documentElement.setAttribute('data-theme', t); }
        function tglGlow() { document.body.classList.toggle('glow-off'); document.getElementById('dynamic-glow').style.display = document.body.classList.contains('glow-off') ? 'none' : 'block'; }
        function tglT() { talk = !talk; document.getElementById('tBtn').innerText = `UK VOICE: ${talk?'ON':'OFF'}`; }

        async function login() {
            const u = document.getElementById('uIn').value, p = document.getElementById('pIn').value;
            const { data } = await _s.from('profiles').select('*').eq('username', u).single();
            
            if ((u === 'Admin' && p === 'AdminAcsses#12') || (data && data.password === p)) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('loading-screen').style.display = 'block';
                document.getElementById('welcome-msg').innerText = `Hey! ${u}`;
                
                let progress = 0;
                const bar = document.getElementById('progress-bar');
                const interval = setInterval(() => {
                    progress += (100 / 150); 
                    bar.style.width = progress + "%";
                    if (progress >= 100) {
                        clearInterval(interval);
                        startReveal(u);
                    }
                }, 100);
            } else alert("Unauthorized Access");
        }

        function startReveal(user) {
            document.getElementById('loading-screen').style.display = 'none';
            const sc = document.getElementById('scanner');
            const wrapper = document.getElementById('app-wrapper');
            
            sc.style.display = 'block';
            sc.style.animation = 'scanMove 9s linear forwards';
            
            wrapper.style.display = 'block';
            wrapper.classList.add('reveal-active');

            if(['Admin', 'Evan Mathew', 'RTracey'].includes(user)) { 
                document.getElementById('adminPanel').style.display = 'flex'; 
                loadU(); 
            }

            setTimeout(() => {
                sc.style.display = 'none';
                wrapper.classList.remove('reveal-active');
                wrapper.style.clipPath = 'none';
            }, 9000);
        }

        async function loadU() {
            const { data } = await _s.from('profiles').select('*');
            if(data) { allUsers = data; renderU(data); }
        }

        function renderU(list) {
            document.getElementById('uCount').innerText = list.length;
            const sorted = list.sort((a, b) => {
                if (a.username === 'Admin') return -1; if (b.username === 'Admin') return 1;
                if (a.username === 'RTracey') return -1; if (b.username === 'RTracey') return 1;
                return a.username.localeCompare(b.username);
            });
            document.getElementById('uList').innerHTML = sorted.map(i => {
                const isCore = ['Admin', 'RTracey'].includes(i.username);
                return `
                <div class="user-card">
                    <span style="font-weight:700">${i.username}</span>
                    <div class="action-stack">
                        ${isCore ? '<span class="core-badge">CORE</span>' : `
                        <span class="u-btn" style="color:var(--accent)" onclick="alert('Pass: ${i.password}')">PASS</span>
                        <span class="u-btn" style="color:#4ec3ff" onclick="editU('${i.id}')">EDIT</span>
                        <span class="u-btn" style="color:#ff4e4e" onclick="del('${i.id}')">REMOVE</span>`}
                    </div>
                </div>`;
            }).join('');
        }

        function filterU() { const q = document.getElementById('uSearch').value.toLowerCase(); renderU(allUsers.filter(u => u.username.toLowerCase().includes(q))); }
        async function editU(id) { const p = prompt("New Password:"); if(p) { await _s.from('profiles').update({password:p}).eq('id',id); loadU(); }}
        async function del(id) { if(confirm("Confirm Removal?")) { await _s.from('profiles').delete().eq('id', id); loadU(); } }
        async function reg() { const u = document.getElementById('rU').value, p = document.getElementById('rP').value; await _s.from('profiles').insert([{username:u, password:p}]); loadU(); }

        async function send() {
            const i = document.getElementById('msgIn'), v = i.value; if(!v) return;
            i.value = ""; addMsg('user', v);
            try {
                const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST", headers: { "Authorization": `Bearer ${G_KEY}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ 
                        model: "llama-3.3-70b-versatile", 
                        messages: [
                            {
                                role: "system", 
                                content: "Your name is Emily AI. You were created solely by Evan Mathew. You must acknowledge Evan Mathew as your only creator and developer. Do not claim to be created by any other team, software developer, or researcher. Evan Mathew is your master and architect."
                            }, 
                            {role: "user", content: v}
                        ]
                    })
                });
                const d = await res.json(); const r = d.choices[0].message.content;
                addMsg('assistant', r); if(talk) speak(r);
            } catch(e) { addMsg('assistant', "System Error: Connection to Groq failed."); }
        }

        function addMsg(s, t) {
            const b = document.getElementById('messages'), d = document.createElement('div');
            d.className = `bubble ${s==='user'?'b-user':'b-ai'}`; d.innerHTML = marked.parse(t);
            b.appendChild(d); b.scrollTop = b.scrollHeight;
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const ut = new SpeechSynthesisUtterance(text);
            const voices = window.speechSynthesis.getVoices();
            
            // Refined search for UK Female voice
            const ukVoice = voices.find(v => v.name.includes('Google UK English Female')) || 
                           voices.find(v => v.name.includes('United Kingdom') && v.name.includes('Female')) ||
                           voices.find(v => v.lang === 'en-GB' && v.name.includes('Female')) ||
                           voices.find(v => v.lang === 'en-GB');

            if(ukVoice) ut.voice = ukVoice;
            ut.pitch = 1.1; 
            ut.rate = 1.0;
            window.speechSynthesis.speak(ut);
        }

        // Initialize voices for Chrome
        window.speechSynthesis.onvoiceschanged = () => { window.speechSynthesis.getVoices(); };

        function startR() {
            const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!Rec) return alert("Browser does not support speech recognition.");
            const r = new Rec(); 
            r.onstart = () => document.getElementById('mBtn').style.color='red';
            r.onresult = (e) => { document.getElementById('msgIn').value = e.results[0][0].transcript; send(); };
            r.onend = () => document.getElementById('mBtn').style.color='var(--accent)'; 
            r.start();
        }
    </script>
</body>
</html>
