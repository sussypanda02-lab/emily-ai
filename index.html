<!DOCTYPE html>
<html lang="en" data-theme="purple">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emily A.I|üü¢Active</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #030305; --accent: #c084fc; 
            --glass: rgba(255, 255, 255, 0.03);
            --card-bg: rgba(255, 255, 255, 0.07);
            --border: rgba(255, 255, 255, 0.12);
            --text: #ffffff; --blur: blur(30px);
        }
        [data-theme="red"] { --accent: #ff4e4e; }
        [data-theme="green"] { --accent: #4eff8a; }
        [data-theme="blue"] { --accent: #4ec3ff; }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        
        body { 
            background: var(--bg);
            background-image: radial-gradient(circle at 90% 10%, var(--accent), transparent 600px);
            color: var(--text); min-height: 100vh; width: 100vw; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            overflow-x: hidden;
        }

        .panel { 
            background: var(--glass); backdrop-filter: var(--blur); -webkit-backdrop-filter: var(--blur);
            border: 1px solid var(--border); border-radius: 28px; display: flex; flex-direction: column;
        }

        /* LOGIN BOX */
        #login-screen { width: 90%; max-width: 400px; padding: 50px 40px; text-align: center; }
        .login-input { width: 100%; padding: 18px; background: rgba(0,0,0,0.4); border: 1px solid var(--border); border-radius: 16px; color: white; margin-bottom: 12px; outline: none; }
        .pass-w { position: relative; width: 100%; }
        .eye { position: absolute; right: 20px; top: 18px; cursor: pointer; opacity: 0.6; font-size: 18px; }

        /* APP WRAPPER */
        #app-wrapper { display: none; width: 100%; max-width: 1400px; padding: 20px; }

        .main-container { display: flex; flex-direction: row; gap: 20px; width: 100%; height: 85vh; align-items: stretch; justify-content: center; }
        .sidebar { width: 280px; flex-shrink: 0; }
        .chat-panel { flex: 1; min-width: 0; }
        .admin-panel { width: 320px; flex-shrink: 0; }

        @media (max-width: 1100px) {
            body { justify-content: flex-start; padding-top: 20px; }
            .main-container { flex-direction: column; height: auto; align-items: center; }
            .sidebar, .chat-panel, .admin-panel { width: 100%; max-width: 500px; height: auto; }
            .chat-panel { height: 70vh; order: 1; }
            .sidebar { order: 2; }
            .admin-panel { order: 3; margin-bottom: 60px; }
        }

        /* CHAT INTERNALS */
        #messages { flex-grow: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 15px; scrollbar-width: none; }
        .bubble { padding: 16px 22px; border-radius: 24px; max-width: 85%; font-size: 14px; line-height: 1.6; }
        .b-user { align-self: flex-end; background: var(--accent); color: #000; font-weight: 700; border-bottom-right-radius: 4px; }
        .b-ai { align-self: flex-start; background: var(--card-bg); border: 1px solid var(--border); border-bottom-left-radius: 4px; }

        .input-box { padding: 15px 20px; display: flex; align-items: center; gap: 15px; border-top: 1px solid var(--border); background: rgba(0,0,0,0.2); }
        .input-pill { flex: 1; background: rgba(255,255,255,0.05); border-radius: 50px; padding: 0 20px; border: 1px solid transparent; }
        #msgIn { background: transparent; border: none; padding: 15px 0; color: white; width: 100%; outline: none; }

        /* SEND ARROW STYLE */
        .send-btn { 
            background: var(--accent); color: #000; border: none; 
            width: 45px; height: 45px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; transition: 0.2s; flex-shrink: 0;
        }
        .send-btn:hover { transform: scale(1.05); filter: brightness(1.1); }
        .send-btn svg { width: 20px; height: 20px; fill: currentColor; }

        .action-btn { width: 100%; padding: 15px; border-radius: 18px; border: 1px solid var(--border); background: rgba(255,255,255,0.05); color: white; font-weight: 700; cursor: pointer; margin-bottom: 12px; }
        .theme-dot { height: 45px; border-radius: 14px; cursor: pointer; border: 1px solid var(--border); }
        .admin-only { display: none; }
        .sidebar, .admin-panel { padding: 30px; }
        .user-card { background: rgba(255,255,255,0.04); padding: 14px; border-radius: 18px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border); }
        .del-btn { color: #ff4e4e; font-weight: 800; cursor: pointer; font-size: 11px; padding: 6px 12px; background: rgba(255,78,78,0.1); border-radius: 10px; }
    </style>
</head>
<body>

    <div id="login-screen" class="panel">
        <h1 style="font-size: 32px; margin-bottom: 30px; letter-spacing: -1px;">Emily A.I</h1>
        <input type="text" id="uIn" class="login-input" placeholder="Username">
        <div class="pass-w">
            <input type="password" id="pIn" class="login-input" placeholder="Password">
            <span class="eye" onclick="tglP()">üëÅÔ∏è</span>
        </div>
        <button onclick="login()" class="action-btn" style="background:var(--accent); color:#000; border:none; margin-top:10px">INITIALIZE ACCESS</button>
    </div>

    <div id="app-wrapper">
        <div class="main-container">
            <div class="panel sidebar">
                <p style="font-size:11px; opacity:0.6; margin-bottom:15px; letter-spacing:1px">SYSTEM CORE</p>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom: 25px;">
                    <div class="theme-dot" style="background:#c084fc" onclick="setT('purple')"></div>
                    <div class="theme-dot" style="background:#ff4e4e" onclick="setT('red')"></div>
                    <div class="theme-dot" style="background:#4eff8a" onclick="setT('green')"></div>
                    <div class="theme-dot" style="background:#4ec3ff" onclick="setT('blue')"></div>
                </div>
                <button class="action-btn admin-only" id="tBtn" onclick="tglT()">UK VOICE: OFF</button>
                <button class="action-btn" onclick="document.getElementById('messages').innerHTML=''">NEW SESSION</button>
                <button class="action-btn" style="color:#ff4e4e; border-color:rgba(255,78,78,0.3)" onclick="location.reload()">TERMINATE</button>
            </div>

            <div class="panel chat-panel">
                <div id="messages"></div>
                <div class="input-box">
                    <button class="admin-only" id="mBtn" onclick="startR()" style="background:none; border:none; color:var(--accent); cursor:pointer; font-size:22px">üé§</button>
                    <div class="input-pill">
                        <input type="text" id="msgIn" placeholder="Send a message..." onkeypress="if(event.key=='Enter') send()">
                    </div>
                    <button onclick="send()" class="send-btn">
                        <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                    </button>
                </div>
            </div>

            <div id="adminPanel" class="panel admin-panel admin-only">
                <p style="font-size:11px; opacity:0.6; margin-bottom:15px; letter-spacing:1px">ROOT ACCESS</p>
                <input type="text" id="rU" class="login-input" placeholder="New User" style="font-size:13px">
                <input type="text" id="rP" class="login-input" placeholder="New Pass" style="font-size:13px">
                <button class="action-btn" style="background:var(--accent); color:#000" onclick="reg()">CREATE ACCOUNT</button>
                <div id="uList" style="margin-top:20px; overflow-y:auto; max-height:300px"></div>
            </div>
        </div>
    </div>

    <script>
        const SB_URL = 'https://wssqoindudmqpzaoadbh.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indzc3FvaW5kdWRtcXB6YW9hZGJoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc3MDE0ODgwMCwiZXhwIjoyMDg1NzI0ODAwfQ.-CTdo1CNv_swkxI2KOo5LxmKhr9rzoncBTaXaQXQgz8';
        const G_KEY = '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';
        const _s = supabase.createClient(SB_URL, SB_KEY);
        let USER = null, talk = false;

        function tglP() { const p = document.getElementById('pIn'); p.type = p.type === 'password' ? 'text' : 'password'; }
        function setT(t) { document.documentElement.setAttribute('data-theme', t); }

        async function login() {
            const u = document.getElementById('uIn').value, p = document.getElementById('pIn').value;
            if ((u === 'Admin' && p === 'AdminAcsses#12') || (u === 'Evan Mathew' && p === 'EvanAcsses#12')) {
                startApp({ username: u }); return;
            }
            const { data } = await _s.from('profiles').select('*').eq('username', u).single();
            if (data && data.password === p) startApp(data); else alert("Unauthorized Access");
        }

        function startApp(u) {
            USER = u; document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-wrapper').style.display = 'block';
            if (['Admin', 'Evan Mathew', 'RTracey'].includes(u.username)) {
                document.querySelectorAll('.admin-only').forEach(e => e.style.display = 'block');
                loadU();
            }
        }

        async function loadU() {
            const { data } = await _s.from('profiles').select('*');
            if(data) document.getElementById('uList').innerHTML = data.map(i => `
                <div class="user-card"><span>${i.username}</span>
                ${i.username!=='Admin'?`<span class="del-btn" onclick="del('${i.id}')">REMOVE</span>`:`<small style="opacity:0.4">IMMUTABLE</small>`}</div>`).join('');
        }

        async function del(id) { if(confirm("Confirm Removal?")) { await _s.from('profiles').delete().eq('id', id); loadU(); } }

        function reg() {
            const u = document.getElementById('rU').value, p = document.getElementById('rP').value;
            if(!u || !p) return;
            _s.from('profiles').insert([{username:u, password:p}]).then(() => { loadU(); document.getElementById('rU').value=''; document.getElementById('rP').value=''; });
        }

        async function send() {
            const i = document.getElementById('msgIn'), v = i.value; if(!v) return;
            i.value = ""; addMsg('user', v);
            const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST", headers: { "Authorization": `Bearer ${G_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({ model: "llama-3.3-70b-versatile", messages: [{role:"system",content:"Your name is Emily AI, created by Evan Mathew. Respond naturally."}, {role:"user",content:v}]})
            });
            const d = await res.json(); const r = d.choices[0].message.content;
            addMsg('assistant', r);
            if(talk) { 
                window.speechSynthesis.cancel(); 
                const ut = new SpeechSynthesisUtterance(r);
                const voices = window.speechSynthesis.getVoices();
                const ukVoice = voices.find(v => v.name.includes('Google UK English Female')) || 
                                voices.find(v => v.name.includes('en-GB') && v.name.includes('Female')) || 
                                voices.find(v => v.name.includes('en-GB'));
                if(ukVoice) ut.voice = ukVoice;
                window.speechSynthesis.speak(ut); 
            }
        }

        function addMsg(s, t) {
            const b = document.getElementById('messages'), d = document.createElement('div');
            d.className = `bubble ${s==='user'?'b-user':'b-ai'}`; d.innerHTML = marked.parse(t);
            b.appendChild(d); b.scrollTop = b.scrollHeight;
        }

        function tglT() { talk = !talk; document.getElementById('tBtn').innerText = `UK VOICE: ${talk?'ON':'OFF'}`; }
        function startR() {
            const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
            const r = new Rec(); r.onstart = () => document.getElementById('mBtn').style.color='red';
            r.onresult = (e) => { document.getElementById('msgIn').value = e.results[0][0].transcript; send(); };
            r.onend = () => document.getElementById('mBtn').style.color='var(--accent)'; r.start();
        }
        window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
    </script>
</body>
</html>
